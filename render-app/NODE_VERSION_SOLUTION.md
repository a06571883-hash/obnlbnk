# Решение проблемы с версией Node.js на Render.com

Во время деплоя на Render.com вы столкнулись с ошибками компиляции пакета `better-sqlite3`, связанными с несовместимостью Node.js 23 и этого пакета.

## Проблема

Если вы видите ошибки, похожие на:

```
/opt/render/.cache/node-gyp/23.10.0/include/node/v8config.h:13:2: ошибка: #error "Требуется C++20 или более поздняя версия."
npm error ./src/util/macros.lzz:31:69: ошибка: «CopyablePersistentTraits» не является членом «v8»
```

Это означает, что Render.com использует Node.js 23, а пакет `better-sqlite3` версии 9.x не совместим с этой версией.

## Решение

### 1. Указать точную версию Node.js 18.x

В файле `package.json` указана версия Node.js:

```json
"engines": {
  "node": "18.x"
}
```

Это указывает Render.com использовать Node.js 18.x вместо последней версии 23.x.

### 2. Обработка ошибок с директорией /data

В файлах `build.sh` и `start.sh` добавлена проверка наличия и доступности директории `/data`:

- Если директория `/data` доступна, используем её для хранения данных
- Если директория `/data` недоступна, используем локальную директорию `./data`

### 3. Использование флагов для устойчивой установки пакетов

```bash
npm install --force --no-optional --no-fund
```

Эти флаги позволяют:
- `--force` - принудительно установить пакеты даже при конфликтах зависимостей
- `--no-optional` - пропустить установку опциональных зависимостей
- `--no-fund` - пропустить информацию о финансировании пакетов

## Как проверить решение

После внесения этих изменений выполните новый деплой на Render.com:

1. Опубликуйте изменения в ваш GitHub репозиторий
2. Запустите новый деплой в Render.com, нажав "Manual Deploy" > "Clear build cache & deploy"
3. Проверьте логи сборки на наличие ошибок

## Дополнительные рекомендации

1. Если ошибки продолжаются, можно попробовать перейти на более старую версию `better-sqlite3`:
   ```json
   "better-sqlite3": "^8.0.0"
   ```

2. Если у вас возникают проблемы с доступом к диску в Render.com, убедитесь, что:
   - Диск создан и правильно настроен в dashboard
   - Путь монтирования указан как `/data`
   - Размер диска достаточный (минимум 1 ГБ)

3. При работе с CoinGecko API рекомендуется использовать ключ API для избежания ограничений:
   ```
   COINGECKO_API_KEY=your_api_key_here
   ```