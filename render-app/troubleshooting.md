# Устранение проблем с деплоем на Render.com

## Проблема: "Корневой каталог службы `/opt/render/project/src/render-app` отсутствует"

### Причина
Эта ошибка возникает, когда в настройках сервиса на Render.com указан неверный корневой каталог, или структура файлов в вашем репозитории не соответствует ожидаемой.

### Решение

#### 1. Исправление render.yaml

Если вы используете `render.yaml`, убедитесь, что в нем указана правильная корневая директория:

```yaml
services:
  - name: bnal-bank
    rootDir: .  # Использовать текущую директорию как корневую
    # Остальные настройки...
```

#### 2. Правильная структура репозитория

Убедитесь, что ваш репозиторий имеет следующую структуру:

```
/
├── build.sh
├── start.sh
├── setup-telegram.js
├── package.json
├── render.yaml
├── client/
├── server/
├── shared/
└── другие файлы...
```

Если вы загружаете только директорию `render-app` в репозиторий, то структура должна быть следующей:

```
/
└── render-app/
    ├── build.sh
    ├── start.sh
    ├── setup-telegram.js
    ├── package.json
    ├── render.yaml
    ├── client/
    ├── server/
    ├── shared/
    └── другие файлы...
```

#### 3. Настройки сервиса на Render.com

Если вы настраиваете сервис через веб-интерфейс, проверьте следующие настройки:

1. **Root Directory**:
   - Если весь проект в корне репозитория: оставьте поле пустым или укажите `.`
   - Если проект в директории `render-app`: укажите `render-app`

2. **Build Command**: `chmod +x build.sh && ./build.sh`

3. **Start Command**: `chmod +x start.sh && ./start.sh`

## Проблема: Ошибки при установке зависимостей

### Причина
Некоторые пакеты могут быть несовместимы с версией Node.js на Render.com или иметь конфликты зависимостей.

### Решение

1. Используйте флаги `--force` и `--no-optional` при установке пакетов:
   ```bash
   npm install --force --no-optional
   ```

2. Проверьте совместимость версий пакетов в `package.json`:
   - Проблемные пакеты: `input-otp` и `seatable-api`
   - Используйте более старые версии, если новые не устанавливаются

## Проблема: Ошибка доступа к API CoinGecko (403)

### Причина
API CoinGecko имеет ограничения на количество запросов для бесплатных пользователей.

### Решение

1. Получите API ключ от CoinGecko Pro:
   - Зарегистрируйтесь на [CoinGecko Pro](https://www.coingecko.com/en/api/pricing)

2. Добавьте API ключ в переменные окружения Render.com:
   - Ключ: `COINGECKO_API_KEY`
   - Значение: ваш ключ API

3. Если вы не хотите использовать платный API, приложение будет работать, но с ограниченной функциональностью обновления курсов валют.

## Проблема: Ошибка при настройке Telegram бота

### Причина
Неверный токен бота или проблемы с сетевым соединением до API Telegram.

### Решение

1. Убедитесь, что `TELEGRAM_BOT_TOKEN` указан правильно:
   - Получите токен у [@BotFather](https://t.me/BotFather)
   - Добавьте его в переменные окружения Render.com

2. Проверьте, что `WEBAPP_URL` указан правильно:
   - Должен быть полным URL вашего приложения на Render.com
   - Например: `https://ваш-app.onrender.com`

3. Логи деплоя в Render.com содержат подробную информацию об ошибках настройки бота

## Проблема: База данных не создается или не сохраняется

### Причина
Проблемы с постоянным хранилищем (disk) на Render.com.

### Решение

1. Убедитесь, что диск правильно настроен:
   - Создайте диск размером 1 ГБ с именем `data`
   - Путь монтирования должен быть `/data`

2. Проверьте права доступа:
   - Скрипты `build.sh` и `start.sh` должны иметь права на выполнение
   - Используйте `chmod +x *.sh` в скриптах сборки

## Диагностика проблем

Если проблемы с деплоем продолжаются:

1. Проверьте логи деплоя в разделе "Logs" вашего сервиса на Render.com
2. Временно добавьте команды отладки в `build.sh` и `start.sh`:
   ```bash
   ls -la  # Показать содержимое директории
   pwd     # Показать текущий путь
   env     # Показать переменные окружения
   ```
3. Создайте тестовый файл для проверки доступа к диску:
   ```bash
   echo "test" > /data/test.txt
   ls -la /data/
   ```